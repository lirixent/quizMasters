<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Multiplayer Bible Quiz</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background-color: #f0f0f0;
    }
    #gameArea {
      margin-top: 20px;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      display: none;
    }
    #questionText {
      font-size: 1.2em;
      margin-bottom: 10px;
    }
    input, button {
      padding: 8px;
      margin: 5px 0;
    }
    #feedback {
      margin-top: 10px;
      font-weight: bold;
    }
    #log {
      margin-top: 20px;
      background: #222;
      color: #0f0;
      padding: 10px;
      border-radius: 6px;
      height: 200px;
      overflow-y: auto;
      font-size: 0.9em;
    }
  </style>
</head>
<body>
  <h1>üìñ Multiplayer Bible Quiz</h1>

  <div>
    <label>Session ID:
      <input type="text" id="sessionId" placeholder="e.g., ABC123" />
    </label>
    <br/>
    <label>Your Name:
      <input type="text" id="playerName" placeholder="e.g., Ben" />
    </label>
    <br/>
    <button onclick="joinSession()">Join Game</button>
  </div>

  <div id="gameArea">
    <h2 id="questionText">Waiting for question...</h2>
    <input type="text" id="answerInput" placeholder="Type your answer..." />
    <button onclick="submitAnswer()">Submit Answer</button>
    <div id="feedback"></div>
  </div>

  <div style="margin-top: 15px;">
    <button onclick="startGame()">Start Game (Host Only)</button>
  </div>

  <pre id="log"></pre>

  <script>
    let socket;
    let currentSessionId = '';
    let playerName = '';

    function log(message) {
      const logBox = document.getElementById('log');
      logBox.textContent += message + '\n';
      logBox.scrollTop = logBox.scrollHeight;
    }

    function joinSession() {
      currentSessionId = document.getElementById('sessionId').value.trim();
      playerName = document.getElementById('playerName').value.trim();

      if (!currentSessionId || !playerName) {
        alert('Please enter both session ID and your name');
        return;
      }

      socket = new WebSocket(`ws://${window.location.host}`);

      socket.addEventListener('open', () => {
        log(`‚úÖ Connected to server`);
        socket.send(JSON.stringify({
          event: 'joinSession',
          sessionId: currentSessionId,
          payload: { name: playerName }
        }));
        document.getElementById('gameArea').style.display = 'block';
      });

      socket.addEventListener('message', (event) => {
        const msg = JSON.parse(event.data);
        handleServerEvent(msg);
      });

      socket.addEventListener('close', () => {
        log('‚ö†Ô∏è Disconnected from server');
      });

      socket.addEventListener('error', (err) => {
        log('‚ùå WebSocket error: ' + err.message);
      });
    }

    function startGame() {
      const exampleQuestions = [
        {
          id: '1',
          question: 'Who was the first man in the Bible?',
          correctAnswer: 'Adam',
          category: 'Genesis'
        },
        {
          id: '2',
          question: 'What is the last book of the Bible?',
          correctAnswer: 'Revelation',
          category: 'Revelation'
        },
        {
          id: '3',
          question: 'How many days did God take to create the world?',
          correctAnswer: '6',
          category: 'Genesis'
        }
      ];

      if (socket && socket.readyState === WebSocket.OPEN) {
        socket.send(JSON.stringify({
          event: 'startGame',
          sessionId: currentSessionId,
          payload: { questions: exampleQuestions }
        }));
        log('üü¢ Game started with example questions');
      }
    }

    function submitAnswer() {
      const answer = document.getElementById('answerInput').value.trim();
      if (!answer) return alert('Please enter your answer.');

      if (socket && socket.readyState === WebSocket.OPEN) {
        socket.send(JSON.stringify({
          event: 'submitAnswer',
          sessionId: currentSessionId,
          payload: {
            name: playerName,
            answer: answer
          }
        }));
        document.getElementById('answerInput').value = '';
        document.getElementById('feedback').textContent = 'Answer submitted... waiting for result.';
      }
    }

    function handleServerEvent(msg) {
      switch (msg.event) {
        case 'playerJoined':
          log(`üë§ ${msg.payload.name} joined the session`);
          break;
        case 'newQuestion':
          document.getElementById('questionText').textContent = msg.payload.question;
          document.getElementById('feedback').textContent = '';
          log(`‚ùì New question: ${msg.payload.question}`);
          break;
        case 'answerResult':
          const res = msg.payload;
          document.getElementById('feedback').textContent = `${res.name}'s answer was ${res.correct ? '‚úÖ correct' : '‚ùå incorrect'}. Score: ${res.score}, Time: ${res.timeTaken}s`;
          break;
        case 'gameOver':
          log('üèÅ Game Over!');
          log('üéâ Leaderboard:');
          msg.payload.leaderboardTop3.forEach((p, i) => {
            log(`${i + 1}. ${p.name} - ${p.score} pts (${p.totalTime}s)`);
          });
          log('üß† Full Stats:\n' + JSON.stringify(msg.payload.playerStats, null, 2));
          break;
        default:
          log(`‚ÑπÔ∏è Unknown event: ${JSON.stringify(msg)}`);
      }
    }
  </script>
</body>
</html>
